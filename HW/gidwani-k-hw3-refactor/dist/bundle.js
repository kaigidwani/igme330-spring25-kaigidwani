(()=>{"use strict";var e,t,n,a,r,o,i,c,s;!function(e){e[e.gain=.5]="gain",e[e.numSamples=256]="numSamples"}(s||(s={}));var l=function(e){t.src=e},u=function(e,t,n,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(a,")")},h=function(){function e(e,t,n,a){var r=this;this.image=new Image,this.image.src=e,this.x=t,this.y=n,this.size=a,this.defaultSize=a,this.angle=0,this.scale=1,this.width=a,this.height=a,this.aspectRatio=1,this.image.complete?this.calculateAspectRatio():this.image.onload=function(){return r.calculateAspectRatio()}}return e.prototype.calculateAspectRatio=function(){this.image.width&&this.image.height&&(this.aspectRatio=this.image.width/this.image.height,this.updateDimensions())},e.prototype.updateDimensions=function(){this.aspectRatio>1?(this.width=this.size,this.height=this.size/this.aspectRatio):(this.height=this.size,this.width=this.size*this.aspectRatio)},e.prototype.update=function(e){this.scale=1+e/400,this.size=this.defaultSize*this.scale,this.updateDimensions()},e.prototype.draw=function(e){e.save(),e.translate(this.x,this.y),e.rotate(this.angle),e.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),e.restore()},e}();const f=h;var d,g,m,p,v,y,w=[],b=0,S=new Image;S.src="sprites/vinyl.png";var k=new Image;k.src="sprites/aya oosawa.png";var q=new Image;q.src="sprites/mitsuki koga.png";var T="black",R="white",F=u(172,215,1),z=!0,A=!0,I=!1,M=!1,x=!1,P=!1,E=Object.freeze({sound1:"media/02-The Pretender - Foo Fighters.mp3"}),C=function(c){var u,h,b;u=E.sound1,h=window.AudioContext,e=new h,t=new Audio,l(u),n=e.createMediaElementSource(t),(a=e.createAnalyser()).fftSize=s.numSamples,(r=e.createGain()).gain.value=s.gain,(i=e.createBiquadFilter()).type="lowshelf",(o=e.createBiquadFilter()).type="highshelf",n.connect(a),a.connect(i),i.connect(o),o.connect(r),r.connect(e.destination),console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((b=function(){return 185*Math.random()+35})(),",").concat(b(),",").concat(b(),",1)")));var S=document.querySelector("canvas");D(S,c),function(e,t){d=e.getContext("2d"),g=e.width,m=e.height,p=function(e,t,n,a,r){for(var o=e.createLinearGradient(0,0,0,r),i=0,c=[{percent:0,color:"blue"},{percent:.25,color:"green"},{percent:.5,color:"yellow"},{percent:.75,color:"red"},{percent:1,color:"magenta"}];i<c.length;i++){var s=c[i];o.addColorStop(s.percent,s.color)}return o}(d,0,0,0,m),v=t,y=new Uint8Array(v.fftSize/2),w[0]=new f(k.src,.15*g,.5*m,300),w[1]=new f(q.src,.85*g,.5*m,300)}(S,a),j()},D=function(n,a){document.querySelector("#title").innerHTML=a.title,document.querySelector("#instructions").innerHTML=a.instructions;var s=document.querySelector("#btn-fs"),u=document.querySelector("#btn-play");u.onclick=function(n){console.log("audioCtx.state before = ".concat(e.state));var a=n.target;"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = ".concat(e.state)),"no"==a.dataset.playing?(t.play(),c=!0,a.dataset.playing="yes"):(t.pause(),c=!1,a.dataset.playing="no")},s.onclick=function(e){var t;console.log("goFullscreen() called"),(t=n).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var h=document.querySelector("#slider-volume"),f=document.querySelector("#label-volume");h.oninput=function(e){var t,n=e.target;t=n.value,t=Number(t),r.gain.value=t,f.innerHTML=Math.round(parseFloat(n.value)/2*100).toString()},h.dispatchEvent(new Event("input"));var d=document.querySelector("#track-select");d.innerHTML=a.tracks.map((function(e){return'<option value="'.concat(e.src,'">').concat(e.trackName," - ").concat(e.artistName,"</option>")})).join(""),d.onchange=function(e){var t=e.target;l(t.value),"yes"==u.dataset.playing&&u.dispatchEvent(new MouseEvent("click"))},document.querySelector("#cb-bars").onclick=function(e){var t=e.target;z=t.checked},document.querySelector("#cb-waveform").onclick=function(e){var t=e.target;P=t.checked},document.querySelector("#cb-circles").onclick=function(e){var t=e.target;A=t.checked},document.querySelector("#cb-invert").onclick=function(e){var t=e.target;I=t.checked};var g=document.querySelector("#cb-bass");g.checked=M,g.onchange=function(t){var n=t.target;(M=n.checked)?(i.frequency.setValueAtTime(1500,e.currentTime),i.gain.setValueAtTime(8,e.currentTime)):i.gain.setValueAtTime(0,e.currentTime)};var m=document.querySelector("#cb-treble");m.checked=x,m.onchange=function(t){var n=t.target;(x=n.checked)?(o.frequency.setValueAtTime(1e3,e.currentTime),o.gain.setValueAtTime(8,e.currentTime)):o.gain.setValueAtTime(0,e.currentTime)}},j=function(){requestAnimationFrame(j),function(e){if(e.toggleWaveform?v.getByteTimeDomainData(y):v.getByteFrequencyData(y),d.save(),d.fillStyle=F,d.fillRect(0,0,g,m),d.restore(),e.showGradient&&(d.save(),d.fillStyle=p,d.fillRect(0,0,g,m),d.restore()),e.showBars){var t=(400+g-2.5*y.length-10)/y.length;d.save(),d.fillStyle=R,d.lineWidth=.5,d.strokeStyle=T;for(var n=0;n<y.length;n++)d.fillRect(5+n*(t+2.5),356-y[n],t,100),d.strokeRect(5+n*(t+2.5),356-y[n],t,100);d.restore()}if(e.showCircles){var a=m/3;for(d.save(),d.globalAlpha=.5,n=0;n<y.length;n++){var r=y[n]/255,o=r*a;d.beginPath(),d.fillStyle=u(255,255,255,.34-r/3),d.arc(g/2,m/2,o,0,2*Math.PI,!1),d.fill(),d.closePath(),d.beginPath(),d.fillStyle=u(255,255,255,.1-r/10),d.arc(g/2,m/2,1.5*o,0,2*Math.PI,!1),d.fill(),d.closePath(),d.save(),d.beginPath(),d.fillStyle=u(255,255,255,.5-r/5),d.arc(g/2,m/2,.5*o,0,2*Math.PI,!1),d.fill(),d.closePath(),d.restore()}d.restore()}c&&(b+=.02),S.complete&&(d.save(),d.translate(g/2,m/2),d.rotate(b),d.drawImage(S,-100,-100,200,200),d.restore());var i=d.getImageData(0,0,g,m),s=i.data,l=s.length,h=i.width;for(n=0;n<l;n+=4)e.showNoise&&Math.random()<.5&&(s[n]=s[n+1]=s[n+2]=0,s[n]=172,s[n+1]=215,s[n+2]=1),e.showInvert?(T="white",R="black"):(T="black",R="white");if(e.showEmboss)for(n=0;n<l;n++)n%4!=3&&(s[n]=127+2*s[n]-s[n+4]-s[n+4*h]);var f=0;for(n=0;n<y.length;n++)f+=y[n];var k=f/y.length;d.putImageData(i,0,0),w.forEach((function(e){e.update(k),e.draw(d)}))}({showGradient:!1,showBars:z,showCircles:A,showNoise:!1,showInvert:I,showEmboss:!1,toggleWaveform:P})};window.onload=function(){return e=void 0,t=void 0,a=function(){var e;return function(e,t){var n,a,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&c[0]?a.return:c[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,c[1])).done)return r;switch(a=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],a=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(t){switch(t.label){case 0:return console.log("window.onload called"),[4,fetch("./data/av-data.json")];case 1:return[4,t.sent().json()];case 2:return e=t.sent(),C(e),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((a=a.apply(e,t||[])).next())}));var e,t,n,a}})();